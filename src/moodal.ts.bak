const modalOpen: HTMLButtonElement | null = document.querySelector('.modal__open');
const root: HTMLElement | null = document.querySelector('.root');

// Separate creation of buttons so that event handlers can be hung on them:
const modalCancel: HTMLButtonElement = document.createElement('button');
modalCancel.classList.add('btn', 'modal__cancel'); 
modalCancel.innerHTML = 'Cancel';

const modalSubmit: HTMLButtonElement = document.createElement('button');
modalSubmit.classList.add('btn', 'modal__submit');
modalSubmit.innerHTML = 'Submit';

let modal: HTMLDivElement | null = null; // Variable for accessing the modal window
let modalFooter: HTMLDivElement | null = null; // Variable for accessing the place where the buttons of the modal window should be inserted

const modalHtml: string = `  
    <div class="modal">
    <h2 class="modal__title">Modal title</h2>
    <div class="modal__body">
        <h3 class="modal__subtitle">Subtitle</h3>
        <div class="modal__text">Lorem ipsum, dolor sit amet, consectetur adipisicing elit. Velit enim est corrupti facere earum ipsam libero exercitationem dolorum animi, voluptates iusto.</div>
        <h3 class="modal__subtitle">Subtitle</h3>
        <div class="modal__text">Lorem ipsum dolor, sit amet consectetur adipisicing elit. Consequatur, accusamus!</div>
        <h3 class="modal__subtitle">Subtitle</h3>
        <div class="modal__text">Lorem ipsum dolor sit amet consectetur adipisicing elit. Deserunt natus, consequatur, a ullam magnam explicabo repudiandae consequuntur dignissimos, maxime molestias doloribus maiores odio optio soluta!</div>

    </div>
    <div class="modal__footer">

    </div>
    </div>
`;

if (modalOpen && root) {
    modalOpen.addEventListener('click', () => {
        if (modal) { // If modal window already added to DOM
            modal.style.display = 'block';
        } else { // First show, added to DOM
            root.insertAdjacentHTML("beforeend", modalHtml);
            modal = document.querySelector<HTMLDivElement>('.modal');
            modalFooter = document.querySelector<HTMLDivElement>('.modal__footer');
            if (modalFooter && modalCancel && modalSubmit) {
                modalFooter.append(modalCancel, modalSubmit);
            }
        }
    });
}


modalCancel.addEventListener('click', () => { // Cancel modal window
    if (modal) {
        modal.style.display = 'none';
    }
});

modalSubmit.addEventListener('click', () => { // Submit modal window
    if (modal) {
        modal.style.display = 'none';
    }
    setTimeout(showStatus, 1000);
});

function showStatus(): void {
    const submitStatusDiv: HTMLDivElement = document.createElement('div');
    submitStatusDiv.classList.add('submit');
    submitStatusDiv.innerHTML = 'Your request has been confirmed';
    if (root) {
        root.append(submitStatusDiv);
    }
    setTimeout(() => {
        submitStatusDiv.remove();
    }, 4000);
}